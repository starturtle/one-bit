name: ci_build

on: [push]

jobs: 
  build: 
    runs-on: windows-latest
    steps: 
    # get the code
    - uses: actions/checkout@v2
    
    # Install latest CMake.
    - uses: lukka/get-cmake@latest

    # Restore from cache the previously built ports.
    - name: Restore from cache and run vcpkg
      uses: lukka/run-vcpkg@v3
      with:
        # Response file stored in source control, it provides the list of ports and triplet(s).
        vcpkgArguments: '@${{ env.vcpkgResponseFile }}'
        # Location of the vcpkg as submodule of the repository.
        vcpkgDirectory: '${{ github.workspace }}/vcpkg'
        # Since the cache must be invalidated when content of the response file changes, let's
        # compute its hash and append this to the computed cache's key.
        appendedCacheKey: ${{ hashFiles(env.vcpkgResponseFile) }}

    # Install latest Qt
    - name: Install Qt
      uses: jurplel/install-qt-action@v2.6.3

    - name: Setup OpenCV
      uses: Dovyski/setup-opencv-action@v1
      with:
        opencv-version: '4.2.0'

    - name: Build c++ project
      uses: nicledomaS/cmake_build_action@v1
      with:
        config: release
